# Django Smart Menu

![Django Version](https://img.shields.io/badge/django-4.x-green.svg)![Python Version](https://img.shields.io/badge/python-3.9+-blue.svg)![License](https://img.shields.io/badge/license-MIT-lightgrey.svg)

**Django Smart Menu** — это гибкое и производительное приложение для Django, которое позволяет создавать, управлять и отображать иерархические (древовидные) меню на сайте. Ключевая особенность приложения — элегантное решение проблемы N+1 запросов, благодаря которому каждое меню отрисовывается за **один-единственный запрос к базе данных**, независимо от его сложности и глубины вложенности.

## Демонстрация

*Ниже показано, как работает меню: активный пункт подсвечивается, а его родительские ветки автоматически разворачиваются, обеспечивая интуитивную навигацию.*

 
![Демонстрация работы меню](./assets/menu_demo.gif)

## Ключевые возможности

*   **Древовидная структура:** Создавайте меню с неограниченным уровнем вложенности.
*   **Высокая производительность: 1 запрос к БД на меню.** Приложение спроектировано так, чтобы избежать лишних обращений к базе данных, что гарантирует быструю загрузку страниц.
*   **Полное управление через админ-панель Django:** Удобно добавляйте, редактируйте и удаляйте пункты меню через стандартный интерфейс администратора.
*   **Автоматическое определение активного пункта:** Меню само определяет текущую страницу по URL и подсвечивает соответствующий пункт.
*   **"Умное" разворачивание веток:** Все родительские элементы активного пункта меню автоматически разворачиваются, делая навигацию наглядной.
*   **Поддержка нескольких меню:** Легко размещайте на одной странице разные меню (например, основное меню в шапке и дополнительное в подвале), управляя ими по уникальному названию.
*   **Гибкая настройка URL:** Задавайте ссылки для пунктов меню как через прямой URL (`/about/`), так и через именованные маршруты Django (`named URL`).

## Архитектурный подход: философия одного запроса

Одной из главных задач при разработке была оптимизация работы с базой данных. Классическая рекурсивная отрисовка древовидных структур часто приводит к проблеме "N+1 запросов", когда для каждого дочернего элемента выполняется отдельный запрос к БД.

В **Django Smart Menu** эта проблема решена следующим образом:

1.  **Единая выборка:** При вызове template-тега `{% draw_menu '...' %}` все пункты, относящиеся к указанному меню, извлекаются из базы данных **одним запросом** (`MenuItem.objects.filter(menu_name=...)`).
2.  **Построение дерева в памяти:** Полученный плоский список элементов преобразуется в иерархическую структуру (дерево) уже в коде Python. Для этого используется словарь, что позволяет связывать дочерние элементы с родительскими за O(N) времени.
3.  **Обработка и передача в шаблон:** Вся логика по определению активного пункта и "развернутых" веток также выполняется в Python. В шаблон передаются уже полностью обработанные и готовые к отрисовке данные.

Такой подход гарантирует максимальную производительность и масштабируемость, даже для очень больших и сложных меню.

## Установка и запуск проекта

Следуйте этим шагам, чтобы развернуть проект локально.

**Требования:**
*   Python 3.9+
*   Git

**1. Клонируйте репозиторий:**
```bash
git clone https://github.com/fluffy-dev/Django-Menu-App.git
cd Django-Menu-App
```

**2. Создайте и активируйте виртуальное окружение:**
```bash
# Создание окружения
python -m venv venv

# Активация
# Для Windows:
venv\Scripts\activate
# Для macOS/Linux:
source venv/bin/activate
```

**3. Установите зависимости:**
```bash
pip install -r requirements.txt
```

**4. Примените миграции:**
Эта команда создаст таблицы в базе данных.
```bash
python manage.py migrate
```

**5. Создайте суперпользователя:**
Он понадобится для доступа к админ-панели.
```bash
python manage.py createsuperuser
```
(Следуйте инструкциям в консоли)

**6. Запустите сервер разработки:**
```bash
python manage.py runserver
```

Проект будет доступен по адресу `http://127.0.0.1:8000/`. Админ-панель — `http://127.0.0.1:8000/admin/`.

## Как использовать

### 1. Управление меню в админ-панели

1.  Зайдите в админ-панель (`/admin/`).
2.  Перейдите в раздел "Пункты меню" (`Menu Items`).
3.  Нажмите "Добавить Пункт меню".

**Ключевые поля:**
*   **Название пункта:** Текст, который увидит пользователь (напр. "О компании").
*   **Название меню:** Уникальный идентификатор меню (напр. `main_menu`, `footer_menu`). Используется для вызова в шаблоне.
*   **Родительский пункт:** Выберите другой пункт, чтобы создать вложенность. Оставьте пустым для элемента верхнего уровня.
*   **Прямой URL:** Явный URL, например `/contacts/`.
*   **Именованный URL:** Имя маршрута из `urls.py`, например `menu:main_page`. Имеет приоритет над прямым URL.

### 2. Отображение меню в шаблоне

Чтобы отобразить меню на любой странице вашего сайта, используйте кастомный template-тег `draw_menu`.

1.  Загрузите теги в начале шаблона: `{% load menu_tags %}`.
2.  Вызовите тег в нужном месте, передав ему уникальное название меню:

```html
{% load menu_tags %}

<!DOCTYPE html>
<html>
<head>
    <title>Мой сайт</title>
</head>
<body>

    <header>
        {# Отрисовка основного меню #}
        {% draw_menu 'main_menu' %}
    </header>

    <main>
        <h1>Содержимое страницы</h1>
    </main>

    <footer>
        {# Отрисовка меню для подвала #}
        {% draw_menu 'footer_menu' %}
    </footer>

</body>
</html>
```

## Стек технологий

*   **Backend:** Python, Django
*   **База данных:** SQLite (по умолчанию), легко заменяется на PostgreSQL или MySQL.

## Дальнейшее развитие (Roadmap)

*   [ ] Реализация кеширования для отрисованных меню для еще большей производительности.
*   [ ] Добавление возможности задавать CSS-классы для пунктов меню через админку.
*   [ ] Улучшение интерфейса в админ-панели с помощью `django-mptt` для наглядного отображения древовидной структуры.
*   [ ] Покрытие кода тестами на 100%.